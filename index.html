<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(to bottom right, #581c87, #1e3a8a, #312e81);
            color: white;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .controls-section {
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-primary {
            flex: 1;
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #7c3aed;
            color: white;
        }

        .btn-secondary:hover {
            background: #6d28d9;
        }

        .current-track {
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .track-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem;
            background: linear-gradient(to bottom right, #ec4899, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .track-name {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .progress-container {
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #374151;
            border-radius: 4px;
            outline: none;
            cursor: pointer;
        }

        .progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #8b5cf6;
            border-radius: 50%;
            cursor: pointer;
        }

        .progress-bar::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #8b5cf6;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #d1d5db;
        }

        .player-controls {
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .control-btn.play {
            width: 70px;
            height: 70px;
            background: #16a34a;
        }

        .control-btn.play:hover {
            background: #15803d;
        }

        .control-btn.pause {
            width: 70px;
            height: 70px;
            background: #ca8a04;
        }

        .control-btn.pause:hover {
            background: #a16207;
        }

        .control-btn.stop {
            background: #dc2626;
        }

        .control-btn.stop:hover {
            background: #b91c1c;
        }

        .control-btn.skip {
            background: #4b5563;
        }

        .control-btn.skip:hover {
            background: #374151;
        }

        .control-btn:disabled {
            background: #1f2937;
            opacity: 0.5;
            cursor: not-allowed;
        }

        .playlist-section {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .playlist-header {
            font-size: 1.125rem;
            font-weight: bold;
            margin-bottom: 0.75rem;
        }

        .empty-playlist {
            text-align: center;
            padding: 2rem;
            color: #9ca3af;
        }

        .empty-icon {
            font-size: 4rem;
            opacity: 0.5;
            margin-bottom: 0.75rem;
        }

        .track-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .track-item.active {
            background: rgba(139, 92, 246, 0.5);
        }

        .track-item:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        .track-item.active:hover {
            background: rgba(139, 92, 246, 0.6);
        }

        .track-info {
            flex: 1;
            cursor: pointer;
            overflow: hidden;
        }

        .track-title {
            font-weight: 600;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .delete-btn {
            padding: 0.5rem;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 0.5rem;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>&#127925; Music Player</h1>
    </div>

    <div class="controls-section">
        <button class="btn btn-primary" onclick="openFileDialog()">
            &#128193; Carica Musica
        </button>
        <button class="btn btn-secondary" onclick="toggleSort()">
            &#128202; <span id="sortLabel">Recente</span>
        </button>
        <input type="file" id="fileInput" accept="audio/*" multiple>
    </div>

    <div class="current-track">
        <div class="track-icon">&#127925;</div>
        <div class="track-name" id="currentTrackName">Nessun brano selezionato</div>
        <div class="progress-container">
            <input type="range" class="progress-bar" id="progressBar" min="0" max="100" value="0">
        </div>
        <div class="time-display">
            <span id="currentTime">0:00</span>
            <span id="duration">0:00</span>
        </div>
    </div>

    <div class="player-controls">
        <button class="control-btn skip" onclick="skipBack()" id="skipBackBtn" disabled>&#9198;&#65039;</button>
        <button class="control-btn play" onclick="playMusic()" id="playBtn">&#9654;&#65039;</button>
        <button class="control-btn pause" onclick="pauseMusic()" id="pauseBtn" style="display: none;">&#9208;&#65039;</button>
        <button class="control-btn stop" onclick="stopMusic()" id="stopBtn" disabled>&#9209;&#65039;</button>
        <button class="control-btn skip" onclick="skipForward()" id="skipForwardBtn" disabled>&#9197;&#65039;</button>
    </div>

    <div class="playlist-section">
        <div class="playlist-header">Playlist (<span id="playlistCount">0</span>)</div>
        <div id="playlistContainer">
            <div class="empty-playlist">
                <div class="empty-icon">&#127925;</div>
                <p>Carica della musica per iniziare</p>
            </div>
        </div>
    </div>

    <audio id="audioPlayer"></audio>

    <script>
        var playlist = [];
        var currentTrackIndex = null;
        var sortBy = 'recent';
        var audio = document.getElementById('audioPlayer');

        function openFileDialog() {
            document.getElementById('fileInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function(event) {
            handleFileSelect(event);
        });

        document.getElementById('progressBar').addEventListener('input', function(event) {
            seekTrack(event);
        });

        function handleFileSelect(event) {
            var files = Array.from(event.target.files);
            var musicFiles = files.filter(function(file) {
                return file.type.startsWith('audio/');
            });
            
            musicFiles.forEach(function(file, index) {
                var track = {
                    id: Date.now() + index,
                    name: file.name.replace(/\.[^/.]+$/, ''),
                    file: file,
                    url: URL.createObjectURL(file),
                    addedAt: new Date()
                };
                playlist.push(track);
            });
            
            renderPlaylist();
            event.target.value = '';
        }

        function toggleSort() {
            sortBy = sortBy === 'recent' ? 'name' : 'recent';
            document.getElementById('sortLabel').textContent = sortBy === 'recent' ? 'Recente' : 'Nome';
            renderPlaylist();
        }

        function getSortedPlaylist() {
            var sorted = playlist.slice();
            if (sortBy === 'name') {
                sorted.sort(function(a, b) {
                    return a.name.localeCompare(b.name);
                });
            }
            return sorted;
        }

        function renderPlaylist() {
            var container = document.getElementById('playlistContainer');
            var sorted = getSortedPlaylist();
            
            document.getElementById('playlistCount').textContent = sorted.length;
            
            if (sorted.length === 0) {
                container.innerHTML = '<div class="empty-playlist"><div class="empty-icon">&#127925;</div><p>Carica della musica per iniziare</p></div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < sorted.length; i++) {
                var track = sorted[i];
                var activeClass = currentTrackIndex === i ? 'active' : '';
                html += '<div class="track-item ' + activeClass + '">';
                html += '<div class="track-info" onclick="playTrack(' + i + ')">';
                html += '<div class="track-title">' + track.name + '</div>';
                html += '</div>';
                html += '<button class="delete-btn" onclick="removeTrack(' + track.id + ')">&#128465;&#65039;</button>';
                html += '</div>';
            }
            container.innerHTML = html;
        }

        function playTrack(index) {
            var sorted = getSortedPlaylist();
            if (index >= 0 && index < sorted.length) {
                currentTrackIndex = index;
                var track = sorted[index];
                audio.src = track.url;
                audio.play();
                document.getElementById('currentTrackName').textContent = track.name;
                updatePlayPauseButtons(true);
                renderPlaylist();
                updateControlButtons();
            }
        }

        function playMusic() {
            if (currentTrackIndex === null && playlist.length > 0) {
                playTrack(0);
            } else if (audio.src) {
                audio.play();
                updatePlayPauseButtons(true);
            }
        }

        function pauseMusic() {
            audio.pause();
            updatePlayPauseButtons(false);
        }

        function stopMusic() {
            audio.pause();
            audio.currentTime = 0;
            updatePlayPauseButtons(false);
            document.getElementById('currentTime').textContent = '0:00';
        }

        function skipBack() {
            if (currentTrackIndex !== null && currentTrackIndex > 0) {
                playTrack(currentTrackIndex - 1);
            }
        }

        function skipForward() {
            var sorted = getSortedPlaylist();
            if (currentTrackIndex !== null && currentTrackIndex < sorted.length - 1) {
                playTrack(currentTrackIndex + 1);
            }
        }

        function removeTrack(id) {
            var sorted = getSortedPlaylist();
            var currentTrack = currentTrackIndex !== null ? sorted[currentTrackIndex] : null;
            
            playlist = playlist.filter(function(track) {
                return track.id !== id;
            });
            
            if (currentTrack && currentTrack.id === id) {
                stopMusic();
                currentTrackIndex = null;
                document.getElementById('currentTrackName').textContent = 'Nessun brano selezionato';
            }
            
            renderPlaylist();
            updateControlButtons();
        }

        function seekTrack(event) {
            var time = parseFloat(event.target.value);
            audio.currentTime = time;
        }

        function updatePlayPauseButtons(isPlaying) {
            document.getElementById('playBtn').style.display = isPlaying ? 'none' : 'flex';
            document.getElementById('pauseBtn').style.display = isPlaying ? 'flex' : 'none';
            document.getElementById('stopBtn').disabled = !isPlaying && audio.currentTime === 0;
        }

        function updateControlButtons() {
            var sorted = getSortedPlaylist();
            document.getElementById('skipBackBtn').disabled = currentTrackIndex === null || currentTrackIndex === 0;
            document.getElementById('skipForwardBtn').disabled = currentTrackIndex === null || currentTrackIndex === sorted.length - 1;
            document.getElementById('playBtn').disabled = playlist.length === 0;
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            var mins = Math.floor(seconds / 60);
            var secs = Math.floor(seconds % 60);
            return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }

        audio.addEventListener('timeupdate', function() {
            document.getElementById('currentTime').textContent = formatTime(audio.currentTime);
            document.getElementById('progressBar').value = audio.currentTime;
        });

        audio.addEventListener('loadedmetadata', function() {
            document.getElementById('duration').textContent = formatTime(audio.duration);
            document.getElementById('progressBar').max = audio.duration;
        });

        audio.addEventListener('ended', function() {
            var sorted = getSortedPlaylist();
            if (currentTrackIndex < sorted.length - 1) {
                skipForward();
            } else {
                stopMusic();
                currentTrackIndex = null;
                document.getElementById('currentTrackName').textContent = 'Nessun brano selezionato';
                renderPlaylist();
            }
        });

        audio.addEventListener('play', function() {
            updatePlayPauseButtons(true);
        });
        
        audio.addEventListener('pause', function() {
            updatePlayPauseButtons(false);
        });
    </script>
</body>
</html>
